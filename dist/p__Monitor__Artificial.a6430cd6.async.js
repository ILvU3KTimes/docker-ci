(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[27],{"/Lqm":function(e,t,a){"use strict";a.r(t);a("+L6B");var n,i,r,o=a("2/Rp"),c=(a("miYZ"),a("tsqr")),l=(a("OaEy"),a("2fM7")),s=(a("g9YV"),a("wCAj")),d=(a("14J3"),a("BMrR")),u=(a("R9oj"),a("ECub")),p=(a("jCWc"),a("kPKH")),m=(a("IzEo"),a("bx4M")),f=(a("Pwec"),a("CtXQ")),g=(a("Awhp"),a("KrTs")),h=a("gWZ8"),v=a.n(h),y=a("2Taf"),E=a.n(y),x=a("vZ4D"),w=a.n(x),k=a("l4Ni"),b=a.n(k),I=a("ujKo"),C=a.n(I),L=a("MhPg"),S=a.n(L),T=(a("y8nQ"),a("Vl3Y")),N=(a("2qtc"),a("kLXV")),M=a("q1tI"),O=a.n(M),j=a("LLXN"),P=a("MuoO"),B=a("Dvey"),R=a("sutq"),V=a("+n12"),A=a("34ay"),D=(a("T+dw"),a("ZFw/")),W=a.n(D),q=a("4/k0"),H=a.n(q),U=a("wHMd"),_=a("kIkA"),K=a("Py4S"),Y=a.n(K);function Z(e,t,a){return t=C()(t),b()(e,z()?Reflect.construct(t,a||[],C()(e).constructor):t.apply(e,a))}function z(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(z=function(){return!!e})()}var J=N["a"].confirm,X=(n=T["a"].create(),i=Object(P["connect"])(function(e){var t=e.artificial,a=e.user;return{artificial:t,user:a}}),n(r=i(r=function(e){function t(e){var a;return E()(this,t),a=Z(this,t,[e]),a.wsUpdateData=function(){a.props.dispatch;var e=Object(V["i"])(!1,5),t="ws://192.168.1.99:8082/daihai/ws/meter/".concat(Object(A["c"])().tenant_id,"/").concat(Object(A["c"])().name,"/").concat(e);console.log("wsUrl",t),R["a"].initConnection(t,function(e){if(console.log("WebSocket Message",e),void 0!==e.status&&a.setState({status:e.status}),e.log){e.log.animation=!1;var t=a.state.eventLog;t.forEach(function(e){Object.keys(e).includes("animation")&&delete e.animation});var n=v()(t);n.unshift(e.log),a.setState({eventLog:n})}if(e.meterReading){var i=a.state.data,r=v()(i);r.unshift(e.meterReading),a.setState({data:r})}})},a.deleteEventLog=function(e){var t=a.state.eventLog,n=t.filter(function(t){return t.eventId!==e});a.setState({eventLog:n})},a.closePlayer=function(e){J({title:"\u5173\u95ed\u786e\u8ba4",content:"\u786e\u5b9a\u5173\u95ed\u8be5\u64ad\u653e\u5668\u5417\uff1f",okText:"\u786e\u5b9a",okType:"danger",cancelText:"\u53d6\u6d88",onOk:function(){var t=a.state.playArr,n=t.filter(function(t){return t.id!==e});a.setState({playArr:n})}})},a.exit=function(){var e=a.props.dispatch;N["a"].confirm({title:"\u9000\u51fa\u786e\u8ba4",content:"\u662f\u5426\u786e\u5b9a\u9000\u51fa\u767b\u5f55\uff1f",okText:"\u786e\u5b9a",okType:"danger",cancelText:"\u53d6\u6d88",onOk:function(){e({type:"login/logout"})},onCancel:function(){}})},a.handleLogClick=function(e){var t=a.props.dispatch;a.setState({visible:!0,fetchStream:!1,logInfo:e}),t({type:"eventMonitor/getBehaviorLog",payload:{eventId:e.eventId}}).then(function(){a.setState({fetchStream:!0})})},a.handleCancel=function(){a.setState({visible:!1})},a.columns=[{title:"\u6444\u50cf\u5934",dataIndex:"deviceName",align:"center",render:function(e){return e||"-"}},{title:"\u4eea\u8868\u540d\u79f0",dataIndex:"cabinetName",align:"center",render:function(e){return e||"-"}},{title:"\u4eea\u8868\u7c7b\u578b",dataIndex:"cabinetType",align:"center",render:function(e){return e||"-"}},{title:"\u4eea\u8868\u7f16\u53f7",dataIndex:"cabinetCode",align:"center",render:function(e){return e||"-"}},{title:"\u9884\u5236\u70b9\u4f4d",dataIndex:"pointCode",align:"center",render:function(e){return e||"-"}},{title:"\u5de1\u68c0\u65f6\u95f4",dataIndex:"inspectionTime",align:"center",render:function(e){return e||"-"}},{title:"\u6240\u5c5e\u533a\u57df",dataIndex:"regionName",align:"center",render:function(e){return e||"-"}},{title:"\u4eea\u8868\u7167\u7247",dataIndex:"meterPhoto",align:"center",render:function(e){return e?O.a.createElement(Y.a,{controller:{close:!0,zoom:!1,download:!0,rotate:!0,flip:!1,pagination:!1},style:{width:"100px",height:"auto"},src:e}):"-"}},{title:"\u4eea\u8868\u8bfb\u6570",dataIndex:"readingResult",align:"center",width:"200px",ellipsis:!0,render:function(e){return e?"\u4eea\u8868".concat(Object.keys(e)[0],"\uff1a").concat(Object.values(e)[0]):"-"}},{title:"\u5de1\u68c0\u7c7b\u578b",dataIndex:"planType",align:"center",render:function(e){return e&&"0"===e?"\u81ea\u52a8\u5de1\u68c0":"\u4eba\u5de5\u5de1\u68c0"}},{title:"\u72b6\u6001",dataIndex:"status",align:"center",render:function(e){return O.a.createElement(g["a"],{status:"0"===e?"success":"warning",text:"0"===e?"\u6b63\u5e38":"\u62a5\u8b66"})}}],a.state={playArr:[],visible:!1,fetchStream:!1,logInfo:{},eventLog:[],id:void 0,status:!1,data:[]},a.boundary={maxPlayerNum:16},a}return S()(t,e),w()(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.dispatch;t({type:"user/fetchCurrent"}),t({type:"artificial/getList"}),t({type:"artificial/status"}).then(function(t){return e.setState({status:t})}),this.wsUpdateData()}},{key:"componentWillUnmount",value:function(){R["a"].destroyResources()}},{key:"render",value:function(){var e=this,t=this.state,a=t.playArr,n=t.visible,i=t.fetchStream,r=t.logInfo,g=this.props,h=g.user.currentUser,v=void 0===h?{}:h,y=g.artificial.list,E=Object(V["a"])();return O.a.createElement(W.a,{title:window.monitorTitle},O.a.createElement("div",{className:H.a.container},O.a.createElement("div",{id:"blockView",className:"".concat(H.a.blockView," ").concat(a&&a.length>0?"":H.a.emptyBlockView)},O.a.createElement(d["a"],{gutter:[1,1]},a&&a.length>0?a.map(function(t){var n=document.getElementById("blockView"),i=n.clientWidth,r=Math.round(a.length>9?i/4:a.length>4?i/3:a.length>1?i/2:i),o=Math.round(1080*r/1920);return O.a.createElement(p["a"],{span:a.length>9?6:a.length>4?8:a.length>1?12:24,key:t.deviceId},O.a.createElement(m["a"],{type:"inner",title:t.deviceName,className:H.a.playerCard,headStyle:{minHeight:0,padding:"5px",backgroundColor:"rgb(23 62 161)",color:"#fff"},bodyStyle:{padding:0},extra:O.a.createElement(f["a"],{type:"close-circle",theme:"twoTone",className:H.a.closeIcon,twoToneColor:"#f5222d",onClick:function(){return e.closePlayer(t.id)}})},E?O.a.createElement(_["a"],{item:t,width:r,height:o,blockWidth:i,blockHeight:n.clientHeight}):O.a.createElement("span",null,Object(j["formatMessage"])({id:"eventMonitor.browserDetect"}))))}):O.a.createElement(u["a"],{image:u["a"].PRESENTED_IMAGE_SIMPLE,description:"\u6682\u65e0\u753b\u9762",style:{color:"#fff"}}))),O.a.createElement("div",{className:H.a.header},O.a.createElement("span",{className:H.a.theTitle},window.monitorTitle),O.a.createElement("div",{className:H.a.personCenter,onClick:function(){e.exit()}},O.a.createElement("div",{className:H.a.image}),O.a.createElement("div",{className:H.a.name},v.name),O.a.createElement("div",{className:H.a.exit}))),O.a.createElement("div",{className:H.a.block},O.a.createElement("div",{className:H.a.rightBlock},O.a.createElement(B["c"],{title:Object(j["formatMessage"])({id:"eventMonitor.EventList"}),style:{height:"100%",width:"100%"}},O.a.createElement("div",{style:{height:"calc(100% - 32px)",overflowY:"auto"}},this.state.eventLog.length>0?this.state.eventLog.map(function(t){return O.a.createElement(B["b"],{data:t,key:t&&t.eventId,onRef:function(){return e.handleLogClick(t)}})}):O.a.createElement(u["a"],{image:u["a"].PRESENTED_IMAGE_SIMPLE,style:{color:"#fff"}})))),O.a.createElement("div",{className:H.a.underTable},O.a.createElement(s["a"],{columns:this.columns,dataSource:this.state.data,pagination:!1,size:"small",rowKey:"readingId",bordered:!1})),O.a.createElement("div",{style:{marginTop:"-30px",marginLeft:"10px",pointerEvents:"auto"}},O.a.createElement(l["a"],{showSearch:!0,style:{width:250},placeholder:"\u8bf7\u9009\u62e9\u5de1\u68c0\u8ba1\u5212",optionFilterProp:"children",onChange:function(t){return e.setState({id:t})},filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},disabled:!this.state.status},y.map(function(e){return O.a.createElement(l["a"].Option,{key:e.planId,value:e.planId},e.planName)})),O.a.createElement(o["a"],{type:this.state.status?"primary":"danger",style:{marginLeft:"18px"},onClick:function(){var t=e.props.dispatch;!e.state.status||e.state.id?e.state.status?t({type:"artificial/start",payload:e.state.id}):t({type:"artificial/stop"}):c["a"].warn("\u8bf7\u9009\u62e9\u5de1\u68c0\u8ba1\u5212")}},this.state.status?"\u5f00\u59cb":"\u7ec8\u6b62"))),r?O.a.createElement(U["a"],{visible:n,handleCancel:this.handleCancel,logInfo:r,fetchStream:i,deleteCallback:this.deleteEventLog}):null))}}])}(M["Component"]))||r)||r);t["default"]=X},"4/k0":function(e,t,a){e.exports={container:"antd-pro-pages-monitor-artificial-index-container",blockView:"antd-pro-pages-monitor-artificial-index-blockView",playerCard:"antd-pro-pages-monitor-artificial-index-playerCard",closeIcon:"antd-pro-pages-monitor-artificial-index-closeIcon",emptyBlockView:"antd-pro-pages-monitor-artificial-index-emptyBlockView",header:"antd-pro-pages-monitor-artificial-index-header",theTitle:"antd-pro-pages-monitor-artificial-index-theTitle",personCenter:"antd-pro-pages-monitor-artificial-index-personCenter",image:"antd-pro-pages-monitor-artificial-index-image",name:"antd-pro-pages-monitor-artificial-index-name",exit:"antd-pro-pages-monitor-artificial-index-exit",block:"antd-pro-pages-monitor-artificial-index-block",rightBlock:"antd-pro-pages-monitor-artificial-index-rightBlock",underTable:"antd-pro-pages-monitor-artificial-index-underTable",videoEmpty:"antd-pro-pages-monitor-artificial-index-videoEmpty",download:"antd-pro-pages-monitor-artificial-index-download"}}}]);