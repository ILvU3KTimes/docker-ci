(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[30],{ALkd:function(e,t,n){e.exports={StreamPlay:"antd-pro-pages-stream-media-stream-play-StreamPlay",list:"antd-pro-pages-stream-media-stream-play-list",listHeader:"antd-pro-pages-stream-media-stream-play-listHeader",listItem:"antd-pro-pages-stream-media-stream-play-listItem",checkbox:"antd-pro-pages-stream-media-stream-play-checkbox",emptyCard:"antd-pro-pages-stream-media-stream-play-emptyCard",closeIcon:"antd-pro-pages-stream-media-stream-play-closeIcon",playerCard:"antd-pro-pages-stream-media-stream-play-playerCard"}},XVKO:function(e,t,n){"use strict";n.r(t);n("14J3");var a=n("BMrR"),o=(n("R9oj"),n("ECub")),l=(n("IzEo"),n("bx4M")),r=(n("Pwec"),n("CtXQ")),i=(n("jCWc"),n("kPKH")),c=(n("Mwp2"),n("VXEj")),s=(n("5Dmo"),n("3S7+")),d=(n("Awhp"),n("KrTs")),u=(n("sRBo"),n("kaz8")),p=n("2Taf"),m=n.n(p),f=n("vZ4D"),h=n.n(f),v=n("l4Ni"),y=n.n(v),E=n("ujKo"),g=n.n(E),I=n("MhPg"),S=n.n(I),C=(n("2qtc"),n("kLXV")),b=n("q1tI"),w=n.n(b),A=n("MuoO"),D=n("+n12"),R=n("OsNH"),N=n("p0pE"),x=n.n(N),T=n("jehZ"),O=n.n(T),k=n("Y/ft"),M=n.n(k),P=n("9uWT"),L=n.n(P),_=n("dcbk"),V=n.n(_),H=/(https|http|ws|wss):\/\//;function B(e){var t=e.elementId,n=e.videoUrl,a=e.tipStyle,o=e.onPlay,l=M()(e,["elementId","videoUrl","tipStyle","onPlay"]),r=null,i=null,c=Object(b["useRef"])(0),s={type:"flv",isLive:!0,cors:!0,hasAudio:!1,hasVideo:!0,url:H.test(n)?n:""};console.log("pattern",H.test(n));var d={enableStashBuffer:!0,autoCleanupMaxBackwardDuration:60,autoCleanupMinBackwardDuration:30,statisticsInfoReportInterval:1e3,stashInitialSize:512,enableDurationMonitor:!0,enableVideoFrozenMonitor:!0,videoStateMonitorInterval:1e3,decreaseDurationStep:2};function u(){r.on(L.a.Events.METADATA_ARRIVED,function(){console.log("--== meta data arrived ==--",new Date),i&&clearInterval(i)}),r.on(L.a.Events.MEDIA_INFO,function(e){console.log("--== media info ==--",e),o&&o(e.width,e.height)}),r.enableVideoStateMonitor(!0),r.on(L.a.Events.MEDIA_SOURCE_ENDED,function(){console.log("--== media source ended, normally means server stop push stream ==--",new Date),p(s,d)}),r.on(L.a.Events.MEDIA_SOURCE_CLOSE,function(){console.log("--== media source close, show no source view ==--",new Date)}),r.on(L.a.Events.VIDEO_FROZEN,function(){console.log("--== video frozen ==--",new Date)}),r.on(L.a.Events.ERROR,function(e,t){console.log("--== flvjs error, type:".concat(e,", detail:").concat(t," ==--"),new Date),"NetworkError"!==e&&"OtherError"!==e||p(s,d)}),r.on(L.a.Events.STATISTICS_INFO,function(e){if(console.log("--== STATISTICS_INFO",e),0==c.current)return c.current=e.decodedFrames,void console.log(111);c.current!=e.decodedFrames?(c.current=e.decodedFrames,console.log(222)):(c.current=0,r&&p())}),r.on(L.a.Events.LOADING_COMPLETE,function(e,t){console.log("--== LOADING_COMPLETE")}),r.on(L.a.Events.RECOVERED_EARLY_EOF,function(e,t){console.log("--== RECOVERED_EARLY_EOF")}),r.on(L.a.Events.MEDIA_INFO,function(e,t){console.log("--== MEDIA_INFO")}),r.on(L.a.Events.METADATA_ARRIVED,function(e,t){console.log("--== METADATA_ARRIVED")}),r.on(L.a.Events.SCRIPTDATA_ARRIVED,function(e,t){console.log("--== SCRIPTDATA_ARRIVED")})}function p(){console.log("\u521b\u5efa\u4e4b\u524dplayer",r);var e=document.getElementById(t);console.log(e),r&&(r.unload(),r.detachMediaElement(),r.destroy(),r=null),s.url.length>0&&(console.log("url",s.url),r=L.a.createPlayer(s,d)),console.log("\u521b\u5efa\u4e4b\u540eplayer",r),r&&e&&(u(),r.attachMediaElement(e),r.load())}return Object(b["useEffect"])(function(){L.a.isSupported()&&p();var e=setInterval(function(){if(r.buffered.length){var e=r.buffered.end(0);console.log("end:::"+e);var t=e-r.currentTime;console.log("diff:::"+t),t>=3&&(r.currentTime=r.buffered.end(0))}},2e3);return function(){console.log("\u89e3\u7ed1\u4e4b\u524dplayer",r),r&&(r.destroy(),r=null),console.log("\u89e3\u7ed1\u4e4b\u540eplayer",r),console.log("\u6e05\u9664\u4e4b\u524d",i),i&&clearInterval(i),console.log("\u6e05\u9664\u4e4b\u540e",i),e&&clearInterval(e)}},[]),H.test(n)?w.a.createElement("video",O()({},l,{className:V.a.livePlayer,id:t,controls:!0,muted:!0,autoPlay:!0,disablePictureInPicture:!0}),"\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 video \u6807\u7b7e\u3002"):w.a.createElement("span",{style:x()({},a)},"\u64ad\u653e\u5730\u5740\u9519\u8bef")}var F=B,j=n("eHn4"),W=n.n(j),U=n("TSYQ"),z=n.n(U),J=n("mcBY"),Y=n.n(J);function G(e,t,n){return t=g()(t),y()(e,K()?Reflect.construct(t,n||[],g()(e).constructor):t.apply(e,n))}function K(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(K=function(){return!!e})()}var X,q,Z=void 0!==document.body.style.webkitLineClamp,Q={overflowWrap:"break-word",wordWrap:"break-word"},$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.split("").reduce(function(e,t){var n=t.charCodeAt(0);return n>=0&&n<=128?e+1:e+2},0)},ee=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=0;return e.split("").reduce(function(e,a){var o=a.charCodeAt(0);return n+=o>=0&&o<=128?1:2,n<=t?e+a:e},"")},te=function(e){var t=e.tooltip,n=e.placement,a=e.overlayStyle,o=e.title,l=e.children;if(t){var r=!0===t?{overlayStyle:a,title:o,placement:n}:x()({},t,{overlayStyle:a,title:o,placement:n});return w.a.createElement(s["a"],r,l)}return l},ne=function(e){var t=e.text,n=e.length,a=e.tooltip,o=e.placement,l=e.fullWidthRecognition,r=M()(e,["text","length","tooltip","placement","fullWidthRecognition"]);if("string"!==typeof t)throw new Error("Ellipsis children must be string.");var i=l?$(t):t.length;if(i<=n||n<0)return w.a.createElement("span",r,t);var c,s="...";c=n-s.length<=0?"":l?ee(t,n):t.slice(0,n);var d=a?{}:x()({},r);return te({tooltip:a,placement:o,overlayStyle:Q,title:t,children:w.a.createElement("span",d,c,s)})},ae=function(e){function t(){var e;m()(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return e=G(this,t,[].concat(a)),e.state={text:"",targetCount:0},e.computeLine=function(){var t=e.props.lines;if(t&&!Z){var n=e.shadowChildren.innerText||e.shadowChildren.textContent,a=parseInt(getComputedStyle(e.root).lineHeight,10),o=t*a;e.content.style.height="".concat(o,"px");var l=e.shadowChildren.offsetHeight,r=e.shadow.firstChild;if(l<=o)return void e.setState({text:n,targetCount:n.length});var i=n.length,c=Math.ceil(i/2),s=e.bisection(o,c,0,i,n,r);e.setState({text:n,targetCount:s})}},e.bisection=function(t,n,a,o,l,r){var i="...",c=n,s=o,d=a;r.innerHTML=l.substring(0,c)+i;var u=r.offsetHeight;return u<=t?(r.innerHTML=l.substring(0,c+1)+i,u=r.offsetHeight,u>t||c===d?c:(d=c,c=s-d===1?1+d:Math.floor((s-d)/2)+d,e.bisection(t,c,d,s,l,r))):c-1<0?c:(r.innerHTML=l.substring(0,c-1)+i,u=r.offsetHeight,u<=t?c-1:(s=c,c=Math.floor((s-d)/2)+d,e.bisection(t,c,d,s,l,r)))},e.handleRoot=function(t){e.root=t},e.handleContent=function(t){e.content=t},e.handleNode=function(t){e.node=t},e.handleShadow=function(t){e.shadow=t},e.handleShadowChildren=function(t){e.shadowChildren=t},e}return S()(t,e),h()(t,[{key:"componentDidMount",value:function(){this.node&&this.computeLine()}},{key:"componentDidUpdate",value:function(e){var t=this.props.lines;t!==e.lines&&this.computeLine()}},{key:"render",value:function(){var e=this.state,t=e.text,n=e.targetCount,a=this.props,o=a.children,l=a.lines,r=a.length,i=a.className,c=a.tooltip,s=a.placement,d=a.fullWidthRecognition,u=M()(a,["children","lines","length","className","tooltip","placement","fullWidthRecognition"]),p=z()(Y.a.ellipsis,i,W()(W()({},Y.a.lines,l&&!Z),Y.a.lineClamp,l&&Z));if(!l&&!r)return w.a.createElement("span",O()({className:p},u),o);if(!l)return w.a.createElement(ne,O()({className:p,length:r,text:o||"",tooltip:c,fullWidthRecognition:d},u));var m="antd-pro-ellipsis-".concat("".concat((new Date).getTime()).concat(Math.floor(100*Math.random())));if(Z){var f="#".concat(m,"{-webkit-line-clamp:").concat(l,";-webkit-box-orient: vertical;}"),h=w.a.createElement("div",O()({id:m,className:p},u),w.a.createElement("style",null,f),o);return te({tooltip:c,placement:s,overlayStyle:Q,title:o,children:h})}var v=w.a.createElement("span",{ref:this.handleNode},n>0&&t.substring(0,n),n>0&&n<t.length&&"...");return w.a.createElement("div",O()({},u,{ref:this.handleRoot,className:p}),w.a.createElement("div",{ref:this.handleContent},te({tooltip:c,overlayStyle:Q,title:t,children:v}),w.a.createElement("div",{className:Y.a.shadow,ref:this.handleShadowChildren},o),w.a.createElement("div",{className:Y.a.shadow,ref:this.handleShadow},w.a.createElement("span",null,t))))}}])}(b["Component"]),oe=n("2NJU"),le=n("ALkd"),re=n.n(le),ie=n("GDzq");function ce(e,t,n){return t=g()(t),y()(e,se()?Reflect.construct(t,n||[],g()(e).constructor):t.apply(e,n))}function se(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(se=function(){return!!e})()}var de=C["a"].confirm,ue=(X=Object(A["connect"])(function(e){var t=e.streamPlay;return{streamPlay:t}}),X(q=function(e){function t(e){var n;return m()(this,t),n=ce(this,t,[e]),n.getDeviceList=function(){var e=n.props.dispatch,t=n.state,a=t.selectedValues,o=t.playArr;e(Object(oe["a"])()).then(function(e){var t=n.filterOfflineDevice(e,a),l=n.filterOfflineDevice(e,o);n.setState({selectedValues:t,playArr:l})})},n.filterOfflineDevice=function(e,t){var a=e.filter(function(e){return!1===e.onlineStatus});return a.forEach(function(e){n.cancelSelected(t,e)}),t},n.selectDevice=function(e,t){var a=t.target.checked,o=n.state,l=o.playArr,r=o.selectedValues,i=n.boundary.maxPlayerNum;a?(l.length<i&&l.push(e),r.length<i&&r.push(e.deviceId)):(n.cancelSelected(l,e),n.cancelSelected(r,e)),n.setState({playArr:l,isChecked:a,selectedValues:r})},n.closePlayer=function(e){var t=n.state,a=t.playArr,o=t.selectedValues;de({title:"\u5173\u95ed\u786e\u8ba4",content:"\u786e\u5b9a\u5173\u95ed\u8be5\u64ad\u653e\u5668\u5417\uff1f",okText:"\u786e\u5b9a",okType:"danger",cancelText:"\u53d6\u6d88",onOk:function(){n.cancelSelected(a,e),n.cancelSelected(o,e),n.setState({playArr:a,selectedValues:o})}})},n.cancelSelected=function(e,t){var n=null;e.forEach(function(a){"string"!==typeof a&&"number"!==typeof a||a===t.deviceId&&(n=e.indexOf(a)),"object"===typeof a&&a.deviceId===t.deviceId&&(n=e.indexOf(a))}),(n||0===n)&&e.splice(n,1)},n.state={playArr:[],isChecked:!1,selectedValues:[]},n.boundary={maxPlayerNum:4},n}return S()(t,e),h()(t,[{key:"componentDidMount",value:function(){var e=this;this.getDeviceList(),this.listTimer=setInterval(function(){e.getDeviceList()},6e4)}},{key:"componentWillUnmount",value:function(){null!==this.listTimer&&clearInterval(this.listTimer)}},{key:"render",value:function(){var e=this,t=this.props.streamPlay.deviceList,n=this.state,p=n.playArr,m=n.isChecked,f=n.selectedValues,h=this.boundary.maxPlayerNum,v=Object(D["a"])();return w.a.createElement(R["a"],null,w.a.createElement(a["a"],{gutter:16,className:re.a.StreamPlay},w.a.createElement(i["a"],{span:4},w.a.createElement(u["a"].Group,{value:f,className:re.a.list},w.a.createElement(c["a"],{header:w.a.createElement("div",{className:re.a.listHeader},"\u8bbe\u5907\u5217\u8868"),dataSource:t,renderItem:function(t){var n=t.playAddress,a=void 0===n?"":n,o=JSON.parse(a)||{},l=o.type;return w.a.createElement(c["a"].Item,{className:re.a.listItem},w.a.createElement(u["a"],{value:t.deviceId,checked:m,disabled:!(t.onlineStatus||1===l)||p.length===h,className:re.a.checkbox,onChange:function(n){return e.selectDevice(t,n)}}),w.a.createElement(s["a"],{title:t.onlineStatus||1===l?"\u5728\u7ebf":"\u79bb\u7ebf"},w.a.createElement(d["a"],{status:t.onlineStatus||1===l?"success":"error"})),w.a.createElement(ae,{lines:1,tooltip:!0,placement:"bottomLeft"},t.deviceName))}}))),w.a.createElement(i["a"],{span:20},w.a.createElement(l["a"],{bordered:!1,bodyStyle:{padding:"8px"}},w.a.createElement(a["a"],{gutter:[8,16]},p&&p.length>0?p.map(function(t){var n=t.playAddress,a=void 0===n?"":n,o=JSON.parse(a)||{},c=o.type,s=o.urls,d=void 0===s?[]:s;return w.a.createElement(i["a"],{span:p.length>1?12:24,key:t.deviceId,style:{paddingBottom:0}},w.a.createElement(l["a"],{type:"inner",title:t.deviceName,className:re.a.playerCard,headStyle:{minHeight:0,padding:"8px"},bodyStyle:{padding:"8px 8px 2px 8px"},extra:w.a.createElement(r["a"],{type:"close-circle",theme:"twoTone",className:re.a.closeIcon,twoToneColor:"#f5222d",onClick:function(){return e.closePlayer(t)}})},v?0===c?w.a.createElement(F,{videoUrl:"".concat(d[0].url).concat(t.deviceId),elementId:"videoEle".concat(t.deviceId)}):w.a.createElement(ie["a"],{segments:d,videoType:"flv",loop:"loop",autoPlay:"autoplay"}):w.a.createElement("span",null,"\u63a8\u8350\u4f7f\u7528\u8c37\u6b4c\u6d4f\u89c8\u5668\uff0cEdge\u6d4f\u89c8\u5668\uff0cFirefox\u6d4f\u89c8\u5668")))}):w.a.createElement(l["a"],{bordered:!1,type:"inner",className:re.a.emptyCard},w.a.createElement(o["a"],{image:o["a"].PRESENTED_IMAGE_SIMPLE,description:"\u6682\u65e0\u64ad\u653e\u6e90"})))))))}}])}(b["Component"]))||q);t["default"]=ue},dcbk:function(e,t,n){e.exports={livePlayer:"antd-pro-components-flv-player-index-livePlayer"}},mcBY:function(e,t,n){e.exports={ellipsis:"antd-pro-components-ellipsis-index-ellipsis",lines:"antd-pro-components-ellipsis-index-lines",shadow:"antd-pro-components-ellipsis-index-shadow",lineClamp:"antd-pro-components-ellipsis-index-lineClamp"}}}]);